<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>Task1</title> <link rel="stylesheet" href="styles.css"> </head> <body> <a id="github" href="https://github.com/smir-ant/postgreBolt"><img src="assets/github.svg" alt=""></a> <main> <nav> <a id="proj_name" href="index.html">SAPg</a> <span>ЫЫЫЫЫ</span> </nav> <section id="sect_theory"> <h1>Урок 1. Выборка: основы.</h1> <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Doloremque quisquam labore esse doloribus, a sed voluptatibus obcaecati voluptatem aperiam laborum excepturi voluptas maiores perferendis culpa quibusdam repellat cum ut. Dolorum aperiam aliquam inventore placeat repudiandae culpa delectus natus sapiente ratione cumque at dignissimos rerum, porro dolores adipisci suscipit vero maxime.</p> <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Doloremque quisquam labore esse doloribus, a sed voluptatibus obcaecati voluptatem aperiam laborum excepturi voluptas maiores perferendis culpa quibusdam repellat cum ut. Dolorum aperiam aliquam inventore placeat repudiandae culpa delectus natus sapiente ratione cumque at dignissimos rerum, porro dolores adipisci suscipit vero maxime.</p> <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Doloremque quisquam labore esse doloribus, a sed voluptatibus obcaecati voluptatem aperiam laborum excepturi voluptas maiores perferendis culpa quibusdam repellat cum ut. Dolorum aperiam aliquam inventore placeat repudiandae culpa delectus natus sapiente ratione cumque at dignissimos rerum, porro dolores adipisci suscipit vero maxime.</p> </section> <hr> <section id="sect_practice"> <section id="group_table"> <div id="containerSQL"> <table id="dataTable">   </table> </div> <div id="status">Инициализация БД...</div> </section> <section id="group_task"> <div class="container"> <h3>Урок 1 – Задания</h3> <ol> <li>Find the <code>title</code> of each film</li> <li class="disabled">Find the <code>director</code> of each film</li> <li class="disabled">Find the <code>title</code> and <code>director</code> of each film</li> <li class="disabled">Find the <code>title</code> and <code>year</code> of each film</li> <li class="disabled">Find <code>all</code> the information about each film </li> </ol> </div> <a id="finishBtn" class="disabled" href="lesson02.html">Выполни задания выше</a> </section> <section id="group_code">  <div id="sqlInput" class="code" contenteditable="true" spellcheck="false">SELECT * FROM tablename;</div> </section> </section> </main> <script src="higlightSQL.js">;</script> <script src="isRightAns.js">;</script> <script src="logo.js">;</script> <script type="module">const answers=["SELECT title FROM tablename;","SELECT director FROM tablename;","SELECT title, director FROM tablename;","SELECT title, year FROM tablename;","SELECT * FROM tablename;"];import{PGlite}from"https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/index.js";async function initializeDB(t){setStatus("Инициализация БД..."),db=new PGlite("idb://my-pgdata"),await db.query("DROP TABLE IF EXISTS tablename;"),await db.query("CREATE TABLE tablename (\n            id SERIAL PRIMARY KEY, \n            Title VARCHAR(255) NOT NULL, \n            Director VARCHAR(255) NOT NULL, \n            Year INT NOT NULL, \n            Length_minutes INT NOT NULL);"),await db.query("INSERT INTO tablename (Title, Director, Year, Length_minutes) VALUES\n            ('Toy Story', 'John Lasseter', 1995, 81),\n            ('A Bug''s Life', 'John Lasseter', 1998, 95),\n            ('Toy Story 2', 'John Lasseter', 1999, 93),\n            ('Monsters, Inc.', 'Pete Docter', 2001, 92),\n            ('Finding Nemo', 'Andrew Stanton', 2003, 107),\n            ('The Incredibles', 'Brad Bird', 2004, 116),\n            ('Cars', 'John Lasseter', 2006, 117),\n            ('Ratatouille', 'Brad Bird', 2007, 115),\n            ('WALL-E', 'Andrew Stanton', 2008, 104),\n            ('WALL-E', 'Andrew Stanton', 2008, 104),\n            ('WALL-E', 'Andrew Stanton', 2008, 104),\n            ('WALL-E', 'Andrew Stanton', 2008, 104),\n            ('WALL-E', 'Andrew Stanton', 2008, 104),\n            ('WALL-E', 'Andrew Stanton', 2008, 104),\n            ('Up', 'Pete Docter', 2009, 101);"),setStatus("БД инициализирована и таблица составлена."),fetchTableData()}const statusElement=document.getElementById("status"),dataTable=document.getElementById("dataTable"),sqlInput=document.getElementById("sqlInput"),ddlInput=document.getElementById("ddlInput");let db=null,stagedRows=[];function setStatus(t){console.log(t),statusElement.textContent=t}async function fetchTableData(){setStatus("Извлечение данных...");const t=await db.query("SELECT * FROM tablename;");populateTable(t.rows,t.fields),setStatus(`БД готова к работе. Всего записей: ${t.rows.length}`)}function populateTable(t,e){dataTable.innerHTML="<thead></thead><tbody></tbody>",dataTable.querySelector("thead").innerHTML=`<tr>${e.map((t=>`<th>${t.name}</th>`)).join("")}</tr>`,t.forEach((t=>{const n=`<tr>${e.map((e=>`<td>${t[e.name]}</td>`)).join("")}</tr>`;dataTable.querySelector("tbody").innerHTML+=n}))}let error_translate={"syntax error at or near ":"синтаксическая ошибка возле ","argument of WHERE must be type boolean":"...","operator does not exist: integer == inte":"...","cannot insert multiple commands into a p":"..."};async function executeSQL(){const t=sqlInput.innerHTML.replaceAll("<div>"," ").replaceAll("</div>","").replaceAll("<br>","").replaceAll("&lt;","<").replaceAll("&gt;",">").replace(/(--.*$)/gm,"").replace(/\/\*[\s\S]*?\*\//gm,"").trim();if(console.log("НУ-КА:",t),t){setStatus(`Выполняем запрос: ${t}`);try{if(t.toLowerCase().startsWith("select")){const e=await db.query(t);console.log("ПОЛУЧИЛИ",e),populateTable(e.rows,e.fields),setStatus(`Запрос выполнен. Вернуто ${e.rows.length} строк.`);const n=await db.query(answers[currentTask]);isRightAnswer(e.rows,n.rows)&&nextTask()}else fetchTableData(),setStatus(`SQL executed. Rows affected: ${result.affectedRows??"N/A"}.`)}catch(t){setStatus(`Ошибка при выполнении запроса: ${t.message}`)}}else setStatus("Введи SQL запрос.")}const tasksHTML=document.querySelectorAll("#group_task li");let currentTask=0;async function nextTask(){const t=tasksHTML[currentTask];if(t.classList.add("solved"),t.textContent="✓ "+t.textContent,currentTask+=1,currentTask<tasksHTML.length)tasksHTML[currentTask].classList.remove("disabled");else{const t=document.getElementById("finishBtn");t.textContent="Продолжить",t.classList.remove("disabled")}}sqlInput.oninput=executeSQL,window.onload=()=>initializeDB();</script> 